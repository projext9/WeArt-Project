<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "we.are.travelers.item">

	<!-- 동적 SQL문으로 처리: choose-when-otherwise 구문 -->
	<insert id="addGallery" parameterType="itemVo">
		insert into gallery(gallery_content, origin_filename, system_filename)
			<choose>
				<when test="gallery_content != null">
					values(#{gallery_content}, #{origin_filename}, #{system_filename})
				</when>
				<otherwise>
					values(default, #{origin_filename}, #{system_filename})
				</otherwise>
			</choose>
	</insert>
	
	<select id="getItemList" resultType="itemVo"> <!-- 상품 리스트 호출 -->
		SELECT * FROM weart_item
	</select>

	<select id="getItemDetail" resultType="itemVo">	<!-- 상품 상세 호출 -->
		SELECT * FROM weart_item WHERE item_idx = #{item_idx}
	</select>
	
	<select id="getItemOption" resultType="optionVo"> <!-- 상품 상세 호출(옵션) -->
		SELECT * FROM weart_option WHERE item_idx = #{item_idx}
	</select>

	<insert id="addItemCart" parameterType="map"> <!-- 장바구니 담기 -->
		INSERT INTO weart_cart(member_idx,option_idx,cart_count) VALUES(#{member_idx}, #{option_idx}, #{cart_count})
	</insert>

	<select id="getCartList" resultType="map"> <!-- 1. 장바구니 호출 -->
		SELECT * FROM weart_cart a 
			INNER JOIN weart_option b ON a.option_idx = b.option_idx
			INNER JOIN weart_item c ON b.item_idx = c.item_idx WHERE a.member_idx = #{member_idx}
	</select>
	
	<select id="getItemOrder" parameterType="list" resultType="map"> <!-- 2. 배송지 입력 호출(상품) -->
		SELECT * FROM weart_cart a
			INNER JOIN weart_option b ON a.option_idx = b.option_idx
			INNER JOIN weart_item c ON b.item_idx = c.item_idx WHERE a.cart_idx IN
			<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
				#{item}
			</foreach>
	</select>
	
	<select id="getMemberDetail" resultType="map">	<!-- 2. 배송지 입력 호출(회원정보) -->
		SELECT * FROM weart_member a INNER JOIN weart_address b WHERE a.member_idx = #{member_idx}
	</select>
	
	<delete id="deleteAllOrder"> <!-- 찌꺼기 제거 -->
		DELETE FROM weart_order WHERE member_idx = #{member_idx} AND order_state = "A"
	</delete>
	
	<delete id="deleteAllOrderLast"> <!-- 찌꺼기 제거 -->
		DELETE FROM weart_order_last WHERE member_idx = #{member_idx} AND orderLast_state = "A"
	</delete>
	
	<select id="getItemSelected" resultType="map">	<!-- 카트 선택 상품 호출 -->
		SELECT * FROM weart_cart a 
			INNER JOIN weart_option b ON a.option_idx = b.option_idx
			INNER JOIN weart_item c ON b.item_idx = c.item_idx WHERE a.cart_idx = #{cart_idx}
	</select>
	
	<insert id="addOrderDetail" parameterType="map"> <!-- 주문서 등록(개별상품) -->
		INSERT INTO weart_order(member_idx,orderLast_num,option_idx,company_idx,order_itemName,order_optionName,order_price,order_count,order_postPrice,order_totalPrice) 
		VALUES(#{member_idx}, #{orderLast_num}, #{option_idx}, #{company_idx}, #{order_itemName}, #{order_optionName}, #{order_price}, #{order_count}, #{order_postPrice}, #{order_totalPrice})
	</insert>

	<insert id="addOrderLast" parameterType="map"> <!-- 주문서 등록 -->
		INSERT INTO weart_order_last(orderLast_num,member_idx,orderLast_itemPrice,orderLast_postPrice,orderLast_totalPrice,orderLast_name,orderLast_phone,orderLast_address,orderLast_msg) 
		VALUES(#{orderLast_num}, #{member_idx}, #{orderLast_itemPrice}, #{orderLast_postPrice}, #{orderLast_totalPrice}, #{orderLast_name}, #{orderLast_phone}, #{orderLast_address}, #{orderLast_msg})
	</insert>
	
	<select id="getOrderList" parameterType="map" resultType="orderVo"> <!-- 주문예정 상품 호출 -->
		SELECT * FROM weart_order WHERE member_idx = #{member_idx} AND orderLast_num = #{orderLast_num} AND order_state = #{order_state}
	</select>
	
	<select id="getOrderLast" resultType="orderLastVo">	<!-- 상품 상세 호출 -->
		SELECT * FROM weart_order_last WHERE member_idx = #{member_idx} AND orderLast_num = #{orderLast_num} AND orderLast_state = #{orderLast_state}
	</select>
	
	<select id="getMemberDetail2" resultType="memberVo"> <!-- 회원정보 호출 -->
		SELECT * FROM weart_member WHERE member_idx = #{member_idx}
	</select>

</mapper>